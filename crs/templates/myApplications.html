{% extends "includes/base.html" %}

{% block title %}DENR NCR Client Portal{% endblock title %}

{% block content %}
    <div class="row">
        <div class="col-sm-12">
            <table id="myApplicationList" class="table table-responsive table-striped table-bordered table-sm" cellspacing="0" width="100%" >
                <thead>
                    <tr>
                        <th>Permit</th>
                        <th>Permittee Name</th>
                        <th>Reference Number</th>
                        <th>Date Applied</th>
                        <th>Status</th>
                        <th>Remarks</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

    </div>


    <div class="modal fade" id="applicationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Application Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="applicationModalBody">
                <!-- Application details will be loaded here -->
            </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $('#myApplicationList').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "{% url 'application_list_json' %}",
                    "type": "POST",
                    "headers": { "X-CSRFToken": "{{ csrf_token }}" }
                },
                "columns": [
                    { "data": "permit_type" },
                    { "data": "estab_name" },
                    { "data": "reference_no" },
                    { "data": "date_applied" },
                    { "data": "status" },
                    { "data": "client_remarks" },
                    {
                        "data": null,
                        "render": function(data, type, row) {
                            return `
                                <button class="btn btn-sm btn-primary view-btn" data-reference="${row.reference_no}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            `;
                        },
                        "orderable": false,
                        "searchable": false
                    }
                ]
            });
        });


        $(document).on('click', '.view-btn', function () {
            const referenceNo = $(this).data('reference');
            
            // Optional: fetch more details via AJAX using reference_no
            $('#applicationModalBody').html(`<p><strong>Reference No:</strong> ${referenceNo}</p>`);
            
            // Show the modal
            $('#applicationModal').modal('show');
        });
    </script>
{% endblock %}
